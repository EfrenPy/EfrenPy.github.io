{% include base_path %}

<meta charset="utf-8">

{% include seo.html %}

<link href="{% if site.atom_feed.path %}{{ site.atom_feed.path }}{% else %}{{ base_path }}/feed.xml{% endif %}" type="application/atom+xml" rel="alternate" title="{{ site.title }} Feed">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#52adc8">
<meta name="view-transition" content="same-origin">

<!-- PWA manifest -->
<link rel="manifest" href="/manifest.json">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- Dark mode - prevent flash -->
<script>
  (function() {
    const theme = localStorage.getItem('theme') ||
      (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
  })();
</script>

<!-- Language - prevent flash and auto-detect -->
<script>
  (function() {
    const lang = localStorage.getItem('lang') ||
      (navigator.language.startsWith('es') ? 'es' : 'en');
    document.documentElement.setAttribute('data-lang', lang);
  })();
</script>

<!-- Swup for SPA-like navigation (self-hosted for reliability) -->
<script src="{{ base_path }}/assets/js/swup.min.js?v={{ site.time | date: '%s' }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof Swup !== 'undefined') {
      const swup = new Swup({
        containers: ['#swup-content'],
        animationSelector: '[class*="swup-transition-"]',
        cache: true,
        animateHistoryBrowsing: true
      });

      // Re-initialize scroll reveals after page change
      swup.hooks.on('page:view', function() {
        if (typeof initScrollReveal === 'function') {
          initScrollReveal();
        }
        if (typeof updateActiveNav === 'function') {
          updateActiveNav();
        }
      });
    }
  });
</script>

<!-- Preload critical CSS -->
<link rel="preload" href="{{ base_path }}/assets/css/main.css?v={{ site.time | date: '%s' }}" as="style">

<!-- For all browsers -->
<link rel="stylesheet" href="{{ base_path }}/assets/css/main.css?v={{ site.time | date: '%s' }}">

